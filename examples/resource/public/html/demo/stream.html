<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能对话助手</title>
    <!-- 移除了Font Awesome CDN引用，将使用内联SVG图标替代 -->

    <!-- 自定义工具类 -->
    <!-- 内联基础样式，确保在外部资源加载失败时页面也能正常显示 -->
    <style>
        /* 基础重置和全局样式 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #F7F7F8;
            color: #1F2937;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* 布局样式 */
        header {
            border-bottom: 1px solid #E4E4E7;
            background-color: white;
            backdrop-filter: blur(8px);
            position: sticky;
            top: 0;
            z-index: 30;
            padding: 1rem;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-1 {
            flex: 1;
        }

        .overflow-hidden {
            overflow: hidden;
        }

        main {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        /* 聊天区域样式 */
        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 2rem;
        }

        #chat-messages::-webkit-scrollbar {
            display: none;
        }

        #chat-messages {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 消息气泡样式 */
        .message-appear {
            animation: messageAppear 0.3s ease-out forwards;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .max-w-3xl {
            max-width: 48rem;
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }

        .mb-8 {
            margin-bottom: 2rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .justify-end {
            justify-content: flex-end;
        }

        .bg-primary {
            background-color: #10A37F;
        }

        .bg-neutral-light {
            background-color: #E4E4E7;
        }

        .rounded-lg {
            border-radius: 0.5rem;
        }

        .rounded-tr-none {
            border-top-right-radius: 0;
        }

        .rounded-tl-none {
            border-top-left-radius: 0;
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .py-3 {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }

        .text-white {
            color: white;
        }

        .text-text-primary {
            color: #1F2937;
        }

        .text-text-secondary {
            color: #6B7280;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .w-8,
        .h-8 {
            width: 2rem;
            height: 2rem;
        }

        .rounded-md {
            border-radius: 0.375rem;
        }

        .rounded-full {
            border-radius: 9999px;
        }

        .flex-shrink-0 {
            flex-shrink: 0;
        }

        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 输入区域样式 */
        .border-t {
            border-top: 1px solid #E4E4E7;
        }

        .p-4 {
            padding: 1rem;
        }

        .bg-white {
            background-color: white;
        }

        .relative {
            position: relative;
        }

        #message-input {
            width: 100%;
            background-color: white;
            border: 1px solid #E4E4E7;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            padding-right: 3rem;
            outline: none;
            resize: none;
            height: 4rem;
            color: #1F2937;
            transition: border-color 0.2s;
        }

        #message-input:focus {
            border-color: #10A37F;
        }

        button {
            position: absolute;
            right: 0.75rem;
            bottom: 0.75rem;
            width: 2rem;
            height: 2rem;
            border-radius: 9999px;
            background-color: #10A37F;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: rgba(16, 163, 127, 0.9);
        }

        /* 打字指示器样式 */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background-color: #6B7280;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
        }

        .typing-indicator span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {
            0% {
                transform: translateY(0px);
            }

            28% {
                transform: translateY(-5px);
            }

            44% {
                transform: translateY(0px);
            }
        }

        /* 列表样式 */
        ul {
            list-style-type: disc;
            padding-left: 1.25rem;
            margin-bottom: 0.75rem;
        }

        li {
            margin-bottom: 0.25rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-3 {
            margin-bottom: 0.75rem;
        }

        /* SVG图标样式 */
        .icon {
            width: 16px;
            height: 16px;
            display: block;
        }

        .icon-user,
        .icon-comments,
        .icon-send {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }
    </style>

    <!-- 完全使用内联CSS，不依赖任何外部样式库 -->
</head>

<body class="bg-neutral font-inter text-text-primary min-h-screen flex flex-col overflow-hidden">

    <div class="flex flex-1 overflow-hidden">
        <!-- 侧边栏 -->

        <!-- 主聊天区域 -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- 聊天消息区域 -->
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide">
                <!-- 欢迎消息 -->
                <div class="max-w-3xl mx-auto mb-8 message-appear">
                    <div class="flex gap-4">
                        <div class="w-8 h-8 rounded-md bg-primary flex-shrink-0 flex-center">
                            <svg class="icon-comments" viewBox="0 0 16 16">
                                <path
                                    d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z" />
                            </svg>
                        </div>
                        <div class="bg-neutral-light rounded-lg px-4 py-3 text-text-primary">
                            <p class="mb-2">你好！我是智能对话助手，有什么我可以帮助你的吗？</p>
                            <p class="text-text-secondary text-sm">你可以问我任何问题，我会尽力为你解答。</p>
                        </div>
                    </div>
                </div>

                <!-- 用户消息 -->
                <div class="max-w-3xl mx-auto mb-8 message-appear">
                    <div class="flex gap-4 justify-end">
                        <div class="bg-primary rounded-lg px-4 py-3 text-white">
                            <p>北京有哪些名胜古迹呢</p>
                        </div>
                        <div class="w-8 h-8 rounded-full bg-primary flex-shrink-0 flex-center text-white">
                            <svg class="icon-user" viewBox="0 0 16 16">
                                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                            </svg>
                        </div>
                    </div>
                </div>

            </div>

            <!-- 输入区域 -->
            <div class="border-t border-neutral-light p-4 bg-white backdrop-blur-sm">
                <div class="max-w-3xl mx-auto">
                    <form id="chat-form" class="relative">
                        <textarea id="message-input" placeholder="输入你的消息..."
                            class="w-full bg-white border border-neutral-light rounded-lg px-4 py-3 pr-12 focus:outline-none focus:border-primary transition-colors resize-none h-16 text-text-primary"></textarea>
                        <button type="submit"
                            class="absolute right-3 bottom-3 w-8 h-8 rounded-full bg-primary flex items-center justify-center hover:bg-primary/90 transition-colors">
                            <svg class="icon-send" viewBox="0 0 16 16">
                                <path
                                    d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" />
                            </svg>
                        </button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // 侧边栏切换 - 添加安全检查
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');

        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('hidden');
                sidebar.classList.toggle('absolute');
                sidebar.classList.toggle('h-full');
            });

            // 点击外部关闭侧边栏（移动设备）
            document.addEventListener('click', (e) => {
                if (window.innerWidth < 1024 &&
                    !sidebar.classList.contains('hidden') &&
                    !sidebar.contains(e.target) &&
                    e.target !== sidebarToggle) {
                    sidebar.classList.add('hidden');
                }
            });
        }

        // 聊天表单提交
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const chatMessages = document.getElementById('chat-messages');

        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const message = messageInput.value.trim();
            if (!message) return;

            // 添加用户消息
            addUserMessage(message);

            // 清空输入框
            messageInput.value = '';
            adjustTextareaHeight();

            // 显示正在输入状态
            showTypingIndicator();

            // 模拟AI回复延迟
            setTimeout(() => {
                // 移除正在输入状态
                removeTypingIndicator();

                // 添加AI回复
                addAiResponse(getSampleResponse(message));
            }, 1500);
        });

        // 调整文本框高度
        messageInput.addEventListener('input', adjustTextareaHeight);

        function adjustTextareaHeight() {
            messageInput.style.height = 'auto';
            const scrollHeight = messageInput.scrollHeight;
            // 限制最大高度
            messageInput.style.height = Math.min(scrollHeight, 120) + 'px';
        }

        // 添加用户消息
        function addUserMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'max-w-3xl mx-auto mb-8 opacity-0';
            messageDiv.innerHTML = `
        <div class="flex gap-4 justify-end">
          <div class="bg-primary rounded-lg rounded-tr-none px-4 py-3 text-white">
            <p>${escapeHtml(message)}</p>
          </div>
          <div class="w-8 h-8 rounded-full bg-primary flex-shrink-0 flex-center text-white">
              <svg class="icon-user" viewBox="0 0 16 16">
                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
              </svg>
            </div>
        </div>
      `;

            chatMessages.appendChild(messageDiv);
            // 触发动画
            setTimeout(() => {
                messageDiv.classList.add('message-appear');
            }, 10);

            // 滚动到底部
            scrollToBottom();
        }

        // 显示正在输入状态
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'max-w-3xl mx-auto mb-8 opacity-0';
            typingDiv.innerHTML = `
        <div class="flex gap-4">
          <div class="w-8 h-8 rounded-md bg-primary flex-shrink-0 flex-center">
              <svg class="icon-comments" viewBox="0 0 16 16">
                <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
              </svg>
            </div>
          <div class="bg-neutral-light rounded-lg rounded-tl-none px-4 py-3 text-text-primary">
            <div class="typing-indicator">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      `;

            chatMessages.appendChild(typingDiv);
            // 触发动画
            setTimeout(() => {
                typingDiv.classList.add('message-appear');
            }, 10);

            // 滚动到底部
            scrollToBottom();
        }

        // 移除正在输入状态
        function removeTypingIndicator() {
            const typingDiv = document.getElementById('typing-indicator');
            if (typingDiv) {
                typingDiv.remove();
            }
        }

        // 添加AI回复 - 支持流式响应
        function addAiResponse(prompt) {
            // 创建回复容器
            const responseDiv = document.createElement('div');
            responseDiv.className = 'max-w-3xl mx-auto mb-8 opacity-0';
            responseDiv.innerHTML = `
        <div class="flex gap-4">
          <div class="w-8 h-8 rounded-md bg-primary flex-shrink-0 flex-center">
              <svg class="icon-comments" viewBox="0 0 16 16">
                <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
              </svg>
            </div>
          <div class="bg-neutral-light rounded-lg rounded-tl-none px-4 py-3 text-text-primary">
            <p class="response-text"></p>
          </div>
        </div>
      `;

            chatMessages.appendChild(responseDiv);
            // 触发动画
            setTimeout(() => {
                responseDiv.classList.add('message-appear');
            }, 10);

            // 获取响应文本元素
            const responseTextElement = responseDiv.querySelector('.response-text');

            // 发送流式请求到 /api/demo/v1/stream 接口
            fetch('/api/demo/v1/stream', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ prompt: prompt })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }

                    // 获取响应流的 reader
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let accumulatedResponse = '';

                    // 读取流数据的函数
                    function readStream() {
                        reader.read().then(({ done, value }) => {
                            if (done) {
                                console.log('Stream complete');
                                return;
                            }

                            // 解码新的流数据块
                            const chunk = decoder.decode(value, { stream: true });
                            accumulatedResponse += chunk;

                            // 更新UI显示
                            responseTextElement.textContent = accumulatedResponse;

                            // 继续读取流
                            readStream();
                        }).catch(error => {
                            console.error('Error reading stream:', error);
                            responseTextElement.textContent = 'Sorry, there was an error processing your request.';
                        });
                    }

                    // 开始读取流
                    readStream();
                })
                .catch(error => {
                    console.error('Error fetching stream:', error);
                    responseTextElement.textContent = 'Sorry, there was an error connecting to the server.';
                });

            // 滚动到底部
            setTimeout(() => {
                scrollToBottom();
            }, 10);
        }

        // 滚动到底部
        function scrollToBottom() {
            if (chatMessages) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // 生成示例回复
        function getSampleResponse(message) {
            const responses = [
                "感谢你的提问！关于这个问题，我可以为你提供一些详细的信息和建议。",
                "你提出的这个问题很有深度。让我从几个方面来为你解答。",
                "我理解你的需求了。根据我的分析，以下是一些可能的解决方案。",
                "这个问题很有趣！让我整理一下思路，为你提供一个全面的回答。",
                "谢谢你的消息。关于这个话题，我可以分享一些实用的信息和技巧。"
            ];

            return responses[Math.floor(Math.random() * responses.length)];
        }

        // HTML转义，防止XSS
        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // 初始调整文本框高度
        adjustTextareaHeight();

        // 初始滚动到底部
        scrollToBottom();
    </script>
</body>

</html>